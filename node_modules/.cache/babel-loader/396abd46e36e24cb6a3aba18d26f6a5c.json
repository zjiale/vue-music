{"remainingRequest":"E:\\vue-music\\node_modules\\babel-loader\\lib\\index.js!E:\\vue-music\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\vue-music\\src\\api\\song.js","dependencies":[{"path":"E:\\vue-music\\src\\api\\song.js","mtime":1571193818729},{"path":"E:\\vue-music\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\vue-music\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\vue-music\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport { commonParams } from \"./config\";\nimport { getUid } from 'common/js/uid';\nimport axios from 'axios';\nimport { ERR_OK } from 'api/config';\nexport function getLyric(mid) {\n  var url = '/api/lyric';\n  var data = Object.assign({}, commonParams, {\n    songmid: mid,\n    platform: 'yqq.json',\n    hostUin: 0,\n    needNewCode: 0,\n    categoryId: 10000000,\n    pcachetime: +new Date(),\n    format: 'json',\n    g_tk: 5381\n  });\n  return axios.get(url, {\n    params: data\n  }).then(function (res) {\n    return Promise.resolve(res.data);\n  });\n}\nexport function getSongsUrl(songs) {\n  var url = '/api/getCommonInfo';\n  var mids = [];\n  var types = [];\n  songs.forEach(function (song) {\n    mids.push(song.mid);\n    types.push(0);\n  });\n  var urlMid = genUrlMid(mids, types);\n  var data = Object.assign({}, commonParams, {\n    g_tk: 5381,\n    format: 'json',\n    platform: 'h5',\n    needNewCode: 1,\n    uin: 0\n  });\n  return new Promise(function (resolve, reject) {\n    var tryTime = 3;\n\n    function request() {\n      return axios.post(url, {\n        comm: data,\n        req_0: urlMid\n      }).then(function (response) {\n        var res = response.data;\n\n        if (res.code === ERR_OK) {\n          var _urlMid = res.req_0;\n\n          if (_urlMid && _urlMid.code === ERR_OK) {\n            var purlMap = {};\n\n            _urlMid.data.midurlinfo.forEach(function (item) {\n              if (item.purl) {\n                purlMap[item.songmid] = item.purl;\n              }\n            });\n\n            if (Object.keys(purlMap).length > 0) {\n              resolve(purlMap);\n            } else {\n              retry();\n            }\n          } else {\n            retry();\n          }\n        } else {\n          retry();\n        }\n      });\n    }\n\n    function retry() {\n      if (--tryTime >= 0) {\n        request();\n      } else {\n        reject(new Error('Can not get the songs url'));\n      }\n    }\n\n    request();\n  });\n}\n\nfunction genUrlMid(mids, types) {\n  var guid = getUid();\n  return {\n    module: 'vkey.GetVkeyServer',\n    method: 'CgiGetVkey',\n    param: {\n      guid: guid,\n      songmid: mids,\n      songtype: types,\n      uin: '0',\n      loginflag: 0,\n      platform: '23'\n    }\n  };\n}",{"version":3,"sources":["E:\\vue-music\\src\\api\\song.js"],"names":["commonParams","getUid","axios","ERR_OK","getLyric","mid","url","data","Object","assign","songmid","platform","hostUin","needNewCode","categoryId","pcachetime","Date","format","g_tk","get","params","then","res","Promise","resolve","getSongsUrl","songs","mids","types","forEach","song","push","urlMid","genUrlMid","uin","reject","tryTime","request","post","comm","req_0","response","code","purlMap","midurlinfo","item","purl","keys","length","retry","Error","guid","module","method","param","songtype","loginflag"],"mappings":"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","sourcesContent":["import {\r\n  commonParams\r\n} from './config'\r\nimport {\r\n  getUid\r\n} from 'common/js/uid'\r\nimport axios from 'axios'\r\nimport {\r\n  ERR_OK\r\n} from 'api/config'\r\n\r\nexport function getLyric(mid) {\r\n  const url = '/api/lyric'\r\n\r\n  const data = Object.assign({}, commonParams, {\r\n    songmid: mid,\r\n    platform: 'yqq.json',\r\n    hostUin: 0,\r\n    needNewCode: 0,\r\n    categoryId: 10000000,\r\n    pcachetime: +new Date(),\r\n    format: 'json',\r\n    g_tk: 5381\r\n  })\r\n\r\n  return axios.get(url, {\r\n    params: data\r\n  }).then((res) => {\r\n    return Promise.resolve(res.data)\r\n  })\r\n}\r\n\r\nexport function getSongsUrl(songs) {\r\n  const url = '/api/getCommonInfo'\r\n\r\n  let mids = []\r\n  let types = []\r\n\r\n  songs.forEach((song) => {\r\n    mids.push(song.mid)\r\n    types.push(0)\r\n  })\r\n\r\n  const urlMid = genUrlMid(mids, types)\r\n\r\n  const data = Object.assign({}, commonParams, {\r\n    g_tk: 5381,\r\n    format: 'json',\r\n    platform: 'h5',\r\n    needNewCode: 1,\r\n    uin: 0\r\n  })\r\n\r\n  return new Promise((resolve, reject) => {\r\n    let tryTime = 3\r\n\r\n    function request() {\r\n      return axios.post(url, {\r\n        comm: data,\r\n        req_0: urlMid\r\n      }).then((response) => {\r\n        const res = response.data\r\n        if (res.code === ERR_OK) {\r\n          let urlMid = res.req_0\r\n          if (urlMid && urlMid.code === ERR_OK) {\r\n            const purlMap = {}\r\n            urlMid.data.midurlinfo.forEach((item) => {\r\n              if (item.purl) {\r\n                purlMap[item.songmid] = item.purl\r\n              }\r\n            })\r\n            if (Object.keys(purlMap).length > 0) {\r\n              resolve(purlMap)\r\n            } else {\r\n              retry()\r\n            }\r\n          } else {\r\n            retry()\r\n          }\r\n        } else {\r\n          retry()\r\n        }\r\n      })\r\n    }\r\n\r\n    function retry() {\r\n      if (--tryTime >= 0) {\r\n        request()\r\n      } else {\r\n        reject(new Error('Can not get the songs url'))\r\n      }\r\n    }\r\n\r\n    request()\r\n  })\r\n}\r\n\r\nfunction genUrlMid(mids, types) {\r\n  const guid = getUid()\r\n\r\n  return {\r\n    module: 'vkey.GetVkeyServer',\r\n    method: 'CgiGetVkey',\r\n    param: {\r\n      guid,\r\n      songmid: mids,\r\n      songtype: types,\r\n      uin: '0',\r\n      loginflag: 0,\r\n      platform: '23'\r\n    }\r\n  }\r\n}\r\n"]}]}