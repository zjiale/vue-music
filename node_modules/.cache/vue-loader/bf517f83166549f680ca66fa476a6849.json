{"remainingRequest":"E:\\vue-music\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\vue-music\\src\\components\\player\\player.vue?vue&type=style&index=0&id=510e566f&scoped=true&lang=stylus&rel=stylesheet%2Fstylus&","dependencies":[{"path":"E:\\vue-music\\src\\components\\player\\player.vue","mtime":1571992431383},{"path":"E:\\vue-music\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\vue-music\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\vue-music\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\vue-music\\node_modules\\stylus-loader\\index.js","mtime":1519606876000},{"path":"E:\\vue-music\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\vue-music\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n@import '~common/stylus/variable'\r\n@import '~common/stylus/mixin'\r\n.player\r\n  .normal-player\r\n    position fixed\r\n    left 0\r\n    right 0\r\n    top 0\r\n    bottom 0\r\n    z-index 150\r\n    background $color-background\r\n    .background\r\n      position absolute\r\n      left 0\r\n      top 0\r\n      width 100%\r\n      height 100%\r\n      z-index -1\r\n      opacity 0.6\r\n      filter blur(20px)\r\n    .top\r\n      position relative\r\n      margin-bottom 25px\r\n      .back\r\n        position absolute\r\n        top 0\r\n        left 6px\r\n        z-index 50\r\n        .icon-back\r\n          display block\r\n          padding 9px\r\n          font-size $font-size-large-x\r\n          color $color-theme\r\n          transform rotate(-90deg)\r\n      .title\r\n        width 70%\r\n        margin 0 auto\r\n        line-height 40px\r\n        text-align center\r\n        no-wrap()\r\n        font-size $font-size-large\r\n        color $color-text\r\n      .subtitle\r\n        line-height 20px\r\n        text-align center\r\n        font-size $font-size-medium\r\n        color $color-text\r\n    .middle\r\n      position fixed\r\n      width 100%\r\n      top 80px\r\n      bottom 170px\r\n      white-space nowrap\r\n      font-size 0\r\n      .middle-l\r\n        display inline-block\r\n        vertical-align top\r\n        position relative\r\n        width 100%\r\n        height 0\r\n        padding-top 80%\r\n        .cd-wrapper\r\n          position absolute\r\n          left 10%\r\n          top 0\r\n          width 80%\r\n          height 100%\r\n          .cd\r\n            width 100%\r\n            height 100%\r\n            box-sizing border-box\r\n            border 10px solid rgba(255, 255, 255, 0.1)\r\n            border-radius 50%\r\n            &.play\r\n              animation rotate 20s linear infinite\r\n            &.pause\r\n              animation-play-state paused\r\n            .image\r\n              position absolute\r\n              left 0\r\n              top 0\r\n              width 100%\r\n              height 100%\r\n              border-radius 50%\r\n        .playing-lyric-wrapper\r\n          width 80%\r\n          margin 30px auto 0 auto\r\n          overflow hidden\r\n          text-align center\r\n          .playing-lyric\r\n            height 20px\r\n            line-height 20px\r\n            font-size $font-size-medium\r\n            color $color-text-l\r\n      .middle-r\r\n        display inline-block\r\n        vertical-align top\r\n        width 100%\r\n        height 100%\r\n        overflow hidden\r\n        .lyric-wrapper\r\n          width 80%\r\n          margin 0 auto\r\n          overflow hidden\r\n          text-align center\r\n          .text\r\n            line-height 32px\r\n            color $color-text-l\r\n            font-size $font-size-medium\r\n            &.current\r\n              color $color-text\r\n    .bottom\r\n      position absolute\r\n      bottom 50px\r\n      width 100%\r\n      .dot-wrapper\r\n        text-align center\r\n        font-size 0\r\n        .dot\r\n          display inline-block\r\n          vertical-align middle\r\n          margin 0 4px\r\n          width 8px\r\n          height 8px\r\n          border-radius 50%\r\n          background $color-text-l\r\n          &.active\r\n            width 20px\r\n            border-radius 5px\r\n            background $color-text-ll\r\n      .progress-wrapper\r\n        display flex\r\n        align-items center\r\n        width 80%\r\n        margin 0px auto\r\n        padding 10px 0\r\n        .time\r\n          color $color-text\r\n          font-size $font-size-small\r\n          flex 0 0 30px\r\n          line-height 30px\r\n          width 30px\r\n          &.time-l\r\n            text-align left\r\n          &.time-r\r\n            text-align right\r\n        .progress-bar-wrapper\r\n          flex 1\r\n      .operators\r\n        display flex\r\n        align-items center\r\n        .icon\r\n          flex 1\r\n          color $color-theme\r\n          &.disable\r\n            color $color-theme-d\r\n          i\r\n            font-size 30px\r\n        .i-left\r\n          text-align right\r\n        .i-center\r\n          padding 0 20px\r\n          text-align center\r\n          i\r\n            font-size 40px\r\n        .i-right\r\n          text-align left\r\n        .icon-favorite\r\n          color $color-sub-theme\r\n    &.normal-enter-active, &.normal-leave-active\r\n      transition all 0.4s\r\n      .top, .bottom\r\n        transition all 0.4s cubic-bezier(0.86, 0.18, 0.82, 1.32)\r\n    &.normal-enter, &.normal-leave-to\r\n      opacity 0\r\n      .top\r\n        transform translate3d(0, -100px, 0)\r\n      .bottom\r\n        transform translate3d(0, 100px, 0)\r\n  .mini-player\r\n    display flex\r\n    align-items center\r\n    position fixed\r\n    left 0\r\n    bottom 0\r\n    z-index 180\r\n    width 100%\r\n    height 60px\r\n    background $color-highlight-background\r\n    &.mini-enter-active, &.mini-leave-active\r\n      transition all 0.4s\r\n    &.mini-enter, &.mini-leave-to\r\n      opacity 0\r\n    .icon\r\n      flex 0 0 40px\r\n      width 40px\r\n      padding 0 10px 0 20px\r\n      img\r\n        border-radius 50%\r\n        &.play\r\n          animation rotate 10s linear infinite\r\n        &.pause\r\n          animation-play-state paused\r\n    .text\r\n      display flex\r\n      flex-direction column\r\n      justify-content center\r\n      flex 1\r\n      line-height 20px\r\n      overflow hidden\r\n      .name\r\n        margin-bottom 2px\r\n        no-wrap()\r\n        font-size $font-size-medium\r\n        color $color-text\r\n      .desc\r\n        no-wrap()\r\n        font-size $font-size-small\r\n        color $color-text-d\r\n    .control\r\n      flex 0 0 30px\r\n      width 30px\r\n      padding 0 10px\r\n      .icon-play-mini, .icon-pause-mini, .icon-playlist\r\n        font-size 30px\r\n        color $color-theme-d\r\n      .icon-mini\r\n        font-size 32px\r\n        position absolute\r\n        left 0\r\n        top 0\r\n@keyframes rotate\r\n  0%\r\n    transform rotate(0)\r\n  100%\r\n    transform rotate(360deg)\r\n",{"version":3,"sources":["player.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"player.vue","sourceRoot":"src/components/player","sourcesContent":["<template>\r\n  <div class=\"player\" v-show=\"playlist.length>0\">\r\n    <transition\r\n      name=\"normal\"\r\n      @enter=\"enter\"\r\n      @after-enter=\"afterEnter\"\r\n      @leave=\"leave\"\r\n      @after-leave=\"afterLeave\"\r\n    >\r\n      <div class=\"normal-player\" v-show=\"fullScreen\">\r\n        <div class=\"background\">\r\n          <img width=\"100%\" height=\"100%\" :src=\"currentSong.image\" />\r\n        </div>\r\n        <div class=\"top\">\r\n          <div class=\"back\" @click=\"back\">\r\n            <i class=\"icon-back\"></i>\r\n          </div>\r\n          <h1 class=\"title\" v-html=\"currentSong.name\"></h1>\r\n          <h2 class=\"subtitle\" v-html=\"currentSong.singer\"></h2>\r\n        </div>\r\n        <div\r\n          class=\"middle\"\r\n          @touchstart.prevent=\"middleTouchStart\"\r\n          @touchmove.prevent=\"middleTouchMove\"\r\n          @touchend=\"middleTouchEnd\"\r\n        >\r\n          <div class=\"middle-l\" ref=\"middleL\">\r\n            <div class=\"cd-wrapper\" ref=\"cdWrapper\">\r\n              <div class=\"cd\" :class=\"cdCls\">\r\n                <img class=\"image\" :src=\"currentSong.image\" />\r\n              </div>\r\n            </div>\r\n            <div class=\"playing-lyric-wrapper\">\r\n              <div class=\"playing-lyric\">{{playingLyric}}</div>\r\n            </div>\r\n          </div>\r\n          <scroll class=\"middle-r\" ref=\"lyricList\" :data=\"currentLyric && currentLyric.lines\">\r\n            <div class=\"lyric-wrapper\">\r\n              <div v-if=\"currentLyric\">\r\n                <p\r\n                  ref=\"lyricLine\"\r\n                  class=\"text\"\r\n                  :class=\"{'current': currentLineNum === index}\"\r\n                  v-for=\"(line,index) in currentLyric.lines\"\r\n                  :key=\"index\"\r\n                >{{line.txt}}</p>\r\n              </div>\r\n            </div>\r\n          </scroll>\r\n        </div>\r\n        <div class=\"bottom\">\r\n          <div class=\"dot-wrapper\">\r\n            <span class=\"dot\" :class=\"{'active' : currentShow === 'cd'}\"></span>\r\n            <span class=\"dot\" :class=\"{'active' : currentShow === 'lyric'}\"></span>\r\n          </div>\r\n          <div class=\"progress-wrapper\">\r\n            <span class=\"time time-l\">{{format(currentTime)}}</span>\r\n            <div class=\"progress-bar-wrapper\">\r\n              <progress-bar :percent=\"percent\" @percentChange=\"onProgressBarChange\"></progress-bar>\r\n            </div>\r\n            <span class=\"time time-r\">{{format(currentSong.duration)}}</span>\r\n          </div>\r\n          <div class=\"operators\">\r\n            <div class=\"icon i-left\" @click=\"changeMode\">\r\n              <i :class=\"iconMode\"></i>\r\n            </div>\r\n            <div class=\"icon i-left\" :class=\"disableCls\">\r\n              <i @click=\"prev\" class=\"icon-prev\"></i>\r\n            </div>\r\n            <div class=\"icon i-center\" :class=\"disableCls\">\r\n              <i @click=\"togglePlaying\" :class=\"playIcon\"></i>\r\n            </div>\r\n            <div class=\"icon i-right\" :class=\"disableCls\">\r\n              <i @click=\"next\" class=\"icon-next\"></i>\r\n            </div>\r\n            <div class=\"icon i-right\">\r\n              <i\r\n                class=\"icon\"\r\n                @click=\"toggleFavorite(currentSong)\"\r\n                :class=\"getFavoriteIcon(currentSong)\"\r\n              ></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n    <transition name=\"mini\">\r\n      <div class=\"mini-player\" v-show=\"!fullScreen\" @click=\"open\">\r\n        <div class=\"icon\">\r\n          <img :class=\"cdCls\" width=\"40\" height=\"40\" :src=\"currentSong.image\" />\r\n        </div>\r\n        <div class=\"text\">\r\n          <h2 class=\"name\" v-html=\"currentSong.name\"></h2>\r\n          <p class=\"desc\" v-html=\"currentSong.singer\"></p>\r\n        </div>\r\n        <div class=\"control\">\r\n          <progress-circle :radius=\"radius\" :percent=\"percent\">\r\n            <i @click.stop=\"togglePlaying\" class=\"icon-mini\" :class=\"miniIcon\"></i>\r\n          </progress-circle>\r\n        </div>\r\n        <div class=\"control\" @click.stop @click=\"showPlaylist\">\r\n          <i class=\"icon-playlist\"></i>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n    <playlist ref=\"playlist\"></playlist>\r\n    <audio ref=\"audio\" @caplay=\"ready\" @error=\"error\" @timeupdate=\"updateTime\" @ended=\"end\"></audio>\r\n  </div>\r\n</template>\r\n\r\n<script type=\"text/ecmascript-6\">\r\nimport { mapGetters, mapMutations, mapActions } from 'vuex'\r\nimport animations from 'create-keyframe-animation'\r\nimport { prefixStyle } from 'common/js/dom'\r\nimport ProgressBar from 'base/progress-bar/progress-bar'\r\nimport ProgressCircle from 'base/progress-circle/progress-circle'\r\nimport { playMode } from 'common/js/config'\r\nimport Lyric from 'lyric-parser'\r\nimport Scroll from 'base/scroll/scroll'\r\nimport Playlist from 'components/playlist/playlist'\r\nimport { playerMixin } from 'common/js/mixin'\r\n\r\nconst transform = prefixStyle('transform')\r\nconst transitionDuration = prefixStyle('transitionDuration')\r\n\r\nexport default {\r\n  mixins: [playerMixin],\r\n  data () {\r\n    return {\r\n      songReady: false,\r\n      currentTime: 0,\r\n      radius: 32,\r\n      currentLyric: null,\r\n      currentLineNum: 0,\r\n      currentShow: 'cd',\r\n      playingLyric: ''\r\n    }\r\n  },\r\n  computed: {\r\n    cdCls () {\r\n      return this.playing ? 'play' : 'play pause'\r\n    },\r\n    playIcon () {\r\n      return this.playing ? 'icon-pause' : 'icon-play'\r\n    },\r\n    miniIcon () {\r\n      return this.playing ? 'icon-pause-mini' : 'icon-play-mini'\r\n    },\r\n    disableCls () {\r\n      return this.songReady ? '' : 'disable'\r\n    },\r\n    percent () {\r\n      return this.currentTime / this.currentSong.duration\r\n    },\r\n    ...mapGetters([\r\n      'fullScreen',\r\n      'playing',\r\n      'currentIndex'\r\n    ])\r\n  },\r\n  created () {\r\n    this.touch = {}\r\n  },\r\n  methods: {\r\n    back () {\r\n      this.setFullScreen(false)\r\n    },\r\n    open () {\r\n      this.setFullScreen(true)\r\n    },\r\n    enter (el, done) {\r\n      const { x, y, scale } = this._getPosAndScale()\r\n\r\n      let animation = {\r\n        // 设置百分比下的动画\r\n        0: {\r\n          transform: `translate3d(${x}px,${y}px,0) scale(${scale})`\r\n        },\r\n        60: {\r\n          transform: `translate3d(0,0,0) scale(1.1)`\r\n        },\r\n        100: {\r\n          transform: `translate3d(0,0,0) scale(1)`\r\n        }\r\n      }\r\n\r\n      animations.registerAnimation({\r\n        name: 'move',\r\n        animation,\r\n        presets: {\r\n          duration: 400,\r\n          easing: 'linear'\r\n        }\r\n      })\r\n\r\n      animations.runAnimation(this.$refs.cdWrapper, 'move', done)\r\n    },\r\n    afterEnter () {\r\n      animations.unregisterAnimation('move')\r\n      this.$refs.cdWrapper.style.animation = ''\r\n    },\r\n    leave (el, done) {\r\n      this.$refs.cdWrapper.style.transition = 'all 0.4s'\r\n      const { x, y, scale } = this._getPosAndScale()\r\n      this.$refs.cdWrapper.style[transform] = `translate3d(${x}px,${y}px,0) scale(${scale})`\r\n      this.$refs.cdWrapper.addEventListener('transitionend', done)\r\n    },\r\n    afterLeave () {\r\n      this.$refs.cdWrapper.style.transition = ''\r\n      this.$refs.cdWrapper.style[transform] = ''\r\n    },\r\n    togglePlaying () {\r\n      if (!this.songReady) {\r\n        return\r\n      }\r\n      this.setPlayingState(!this.playing)\r\n      if (this.currentLyric) {\r\n        this.currentLyric.togglePlay()\r\n      }\r\n    },\r\n    end () {\r\n      if (this.mode === playMode.loop) {\r\n        this.loop()\r\n      } else {\r\n        this.next()\r\n      }\r\n    },\r\n    loop () {\r\n      this.$refs.audio.currentTime = 0\r\n      this.$refs.audio.play()\r\n      if (this.currentLyric) {\r\n        this.currentLyric.seek()\r\n      }\r\n    },\r\n    next () {\r\n      if (!this.songReady) {\r\n        return\r\n      }\r\n      if (this.playlist.length === 1) {\r\n        this.loop()\r\n        return\r\n      } else {\r\n        let index = this.currentIndex + 1\r\n        if (index === this.playlist.length) {\r\n          index = 0\r\n        }\r\n        this.setCurrentIndex(index)\r\n        if (!this.playing) {\r\n          this.togglePlaying()\r\n        }\r\n      }\r\n      this.songReady = false\r\n    },\r\n    prev () {\r\n      if (!this.songReady) {\r\n        return\r\n      }\r\n      if (this.playlist.length === 1) {\r\n        this.loop()\r\n        return\r\n      } else {\r\n        let index = this.currentIndex - 1\r\n        if (index === -1) {\r\n          index = this.playlist.length - 1\r\n        }\r\n        this.setCurrentIndex(index)\r\n        if (!this.playing) {\r\n          this.togglePlaying()\r\n        }\r\n      }\r\n      this.songReady = false\r\n    },\r\n    ready () {\r\n      this.songReady = true\r\n      this.savePlayHistory(this.currentSong)\r\n    },\r\n    error () {\r\n      this.songReady = true\r\n    },\r\n    updateTime (e) {\r\n      this.currentTime = e.target.currentTime\r\n    },\r\n    format (interval) {\r\n      interval = interval | 0 // 正数向下取整，相当于调用math.floor\r\n      const minute = interval / 60 | 0\r\n      const second = this._pad(interval % 60)\r\n      return `${minute}:${second}`\r\n    },\r\n    onProgressBarChange (percent) {\r\n      const currentTime = this.currentSong.duration * percent\r\n      this.$refs.audio.currentTime = currentTime\r\n      if (!this.playing) {\r\n        this.togglePlaying()\r\n      }\r\n      if (this.currentLyric) {\r\n        this.currentLyric.seek(currentTime * 1000)\r\n      }\r\n    },\r\n    getLyric () {\r\n      this.currentSong.getLyric().then((lyric) => {\r\n        if (this.currentSong.lyric !== lyric) {\r\n          return\r\n        }\r\n        this.currentLyric = new Lyric(lyric, this.handleLyric)\r\n        if (this.playing) {\r\n          this.currentLyric.play()\r\n        }\r\n        // console.log(this.currentLyric)\r\n      }).catch(() => {\r\n        this.currentLyric = null\r\n        this.playingLyric = ''\r\n        this.currentLineNum = 0\r\n      })\r\n    },\r\n    handleLyric ({ lineNum, txt }) {\r\n      this.currentLineNum = lineNum\r\n      if (lineNum > 5) {\r\n        let lineEl = this.$refs.lyricLine[lineNum - 5]\r\n        this.$refs.lyricList.scrollToElement(lineEl, 1000)\r\n      } else {\r\n        this.$refs.lyricList.scrollToElement(0, 0, 1000)\r\n      }\r\n      this.playingLyric = txt\r\n    },\r\n    showPlaylist () {\r\n      this.$refs.playlist.show()\r\n    },\r\n    middleTouchStart (e) {\r\n      this.touch.initiated = true\r\n      const touch = e.touches[0]\r\n      this.touch.startX = touch.pageX\r\n      this.touch.startY = touch.pageY\r\n    },\r\n    middleTouchMove (e) {\r\n      if (!this.touch.initiated) {\r\n        return\r\n      }\r\n      const touch = e.touches[0]\r\n      const deltaX = touch.pageX - this.touch.startX\r\n      const deltaY = touch.pageY - this.touch.startY\r\n      if (Math.abs(deltaY) > Math.abs(deltaX)) {\r\n        return\r\n      }\r\n      const left = this.currentShow === 'cd' ? 0 : -window.innerWidth\r\n      const offsetWidth = Math.min(0, Math.max(-window.innerWidth, left + deltaX))\r\n      this.touch.percent = Math.abs(offsetWidth / window.innerWidth)\r\n      this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`\r\n      this.$refs.lyricList.$el.style[transitionDuration] = 0\r\n      this.$refs.middleL.style.opacity = 1 - this.touch.percent\r\n      this.$refs.middleL.style[transitionDuration] = 0\r\n    },\r\n    middleTouchEnd (e) {\r\n      let offsetWidth\r\n      let opacity\r\n      if (this.currentShow === 'cd') {\r\n        if (this.touch.percent > 0.1) {\r\n          offsetWidth = -window.innerWidth\r\n          opacity = 0\r\n          this.currentShow = 'lyric'\r\n        } else {\r\n          offsetWidth = 0\r\n          opacity = 1\r\n        }\r\n      } else {\r\n        if (this.touch.percent < 0.9) {\r\n          offsetWidth = 0\r\n          opacity = 1\r\n          this.currentShow = 'cd'\r\n        } else {\r\n          offsetWidth = -window.innerWidth\r\n          opacity = 0\r\n        }\r\n      }\r\n      const time = 300\r\n      this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`\r\n      this.$refs.lyricList.$el.style[transitionDuration] = `${time}ms`\r\n      this.$refs.middleL.style.opacity = opacity\r\n      this.$refs.middleL.style[transitionDuration] = `${time}ms`\r\n    },\r\n    _pad (num, n = 2) { // 补位,如果秒为取整不够2位，则补0，如果大于则直接返回\r\n      let len = num.toString().length\r\n      while (len < n) {\r\n        num = '0' + num\r\n        len++\r\n      }\r\n      return num\r\n    },\r\n    _getPosAndScale () {\r\n      const targetWidth = 40\r\n      const paddingLeft = 40\r\n      const paddingBottom = 30\r\n      const paddingTop = 80\r\n      const width = window.innerWidth * 0.8\r\n      const scale = targetWidth / width\r\n      const x = -(window.innerWidth / 2 - paddingLeft)\r\n      const y = window.innerHeight - paddingTop - width / 2 - paddingBottom\r\n      return {\r\n        x,\r\n        y,\r\n        scale\r\n      }\r\n    },\r\n    ...mapMutations({\r\n      setFullScreen: 'SET_FULL_SCREEN'\r\n    }),\r\n    ...mapActions([\r\n      'savePlayHistory'\r\n    ])\r\n  },\r\n  watch: {\r\n    currentSong (newSong, oldSong) {\r\n      if (!newSong.id || !newSong.url || newSong.id === oldSong.id) {\r\n        return\r\n      }\r\n      this.songReady = false\r\n      // this.canLyricPlay = false\r\n      if (this.currentLyric) {\r\n        this.currentLyric.stop()\r\n        // 重置为null\r\n        this.currentLyric = null\r\n        this.currentTime = 0\r\n        this.playingLyric = ''\r\n        this.currentLineNum = 0\r\n      }\r\n      this.$refs.audio.src = newSong.url\r\n      this.$refs.audio.play()\r\n      // 若歌曲 5s 未播放，则认为超时，修改状态确保可以切换歌曲。\r\n      clearTimeout(this.timer)\r\n      this.timer = setTimeout(() => {\r\n        this.songReady = true\r\n      }, 1000)\r\n      this.getLyric()\r\n    },\r\n    playing (newPlaying) {\r\n      const audio = this.$refs.audio\r\n      this.$nextTick(() => {\r\n        newPlaying ? audio.play() : audio.pause()\r\n      })\r\n    }\r\n  },\r\n  components: {\r\n    ProgressBar,\r\n    ProgressCircle,\r\n    Scroll,\r\n    Playlist\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"stylus\" rel=\"stylesheet/stylus\">\r\n@import '~common/stylus/variable'\r\n@import '~common/stylus/mixin'\r\n.player\r\n  .normal-player\r\n    position fixed\r\n    left 0\r\n    right 0\r\n    top 0\r\n    bottom 0\r\n    z-index 150\r\n    background $color-background\r\n    .background\r\n      position absolute\r\n      left 0\r\n      top 0\r\n      width 100%\r\n      height 100%\r\n      z-index -1\r\n      opacity 0.6\r\n      filter blur(20px)\r\n    .top\r\n      position relative\r\n      margin-bottom 25px\r\n      .back\r\n        position absolute\r\n        top 0\r\n        left 6px\r\n        z-index 50\r\n        .icon-back\r\n          display block\r\n          padding 9px\r\n          font-size $font-size-large-x\r\n          color $color-theme\r\n          transform rotate(-90deg)\r\n      .title\r\n        width 70%\r\n        margin 0 auto\r\n        line-height 40px\r\n        text-align center\r\n        no-wrap()\r\n        font-size $font-size-large\r\n        color $color-text\r\n      .subtitle\r\n        line-height 20px\r\n        text-align center\r\n        font-size $font-size-medium\r\n        color $color-text\r\n    .middle\r\n      position fixed\r\n      width 100%\r\n      top 80px\r\n      bottom 170px\r\n      white-space nowrap\r\n      font-size 0\r\n      .middle-l\r\n        display inline-block\r\n        vertical-align top\r\n        position relative\r\n        width 100%\r\n        height 0\r\n        padding-top 80%\r\n        .cd-wrapper\r\n          position absolute\r\n          left 10%\r\n          top 0\r\n          width 80%\r\n          height 100%\r\n          .cd\r\n            width 100%\r\n            height 100%\r\n            box-sizing border-box\r\n            border 10px solid rgba(255, 255, 255, 0.1)\r\n            border-radius 50%\r\n            &.play\r\n              animation rotate 20s linear infinite\r\n            &.pause\r\n              animation-play-state paused\r\n            .image\r\n              position absolute\r\n              left 0\r\n              top 0\r\n              width 100%\r\n              height 100%\r\n              border-radius 50%\r\n        .playing-lyric-wrapper\r\n          width 80%\r\n          margin 30px auto 0 auto\r\n          overflow hidden\r\n          text-align center\r\n          .playing-lyric\r\n            height 20px\r\n            line-height 20px\r\n            font-size $font-size-medium\r\n            color $color-text-l\r\n      .middle-r\r\n        display inline-block\r\n        vertical-align top\r\n        width 100%\r\n        height 100%\r\n        overflow hidden\r\n        .lyric-wrapper\r\n          width 80%\r\n          margin 0 auto\r\n          overflow hidden\r\n          text-align center\r\n          .text\r\n            line-height 32px\r\n            color $color-text-l\r\n            font-size $font-size-medium\r\n            &.current\r\n              color $color-text\r\n    .bottom\r\n      position absolute\r\n      bottom 50px\r\n      width 100%\r\n      .dot-wrapper\r\n        text-align center\r\n        font-size 0\r\n        .dot\r\n          display inline-block\r\n          vertical-align middle\r\n          margin 0 4px\r\n          width 8px\r\n          height 8px\r\n          border-radius 50%\r\n          background $color-text-l\r\n          &.active\r\n            width 20px\r\n            border-radius 5px\r\n            background $color-text-ll\r\n      .progress-wrapper\r\n        display flex\r\n        align-items center\r\n        width 80%\r\n        margin 0px auto\r\n        padding 10px 0\r\n        .time\r\n          color $color-text\r\n          font-size $font-size-small\r\n          flex 0 0 30px\r\n          line-height 30px\r\n          width 30px\r\n          &.time-l\r\n            text-align left\r\n          &.time-r\r\n            text-align right\r\n        .progress-bar-wrapper\r\n          flex 1\r\n      .operators\r\n        display flex\r\n        align-items center\r\n        .icon\r\n          flex 1\r\n          color $color-theme\r\n          &.disable\r\n            color $color-theme-d\r\n          i\r\n            font-size 30px\r\n        .i-left\r\n          text-align right\r\n        .i-center\r\n          padding 0 20px\r\n          text-align center\r\n          i\r\n            font-size 40px\r\n        .i-right\r\n          text-align left\r\n        .icon-favorite\r\n          color $color-sub-theme\r\n    &.normal-enter-active, &.normal-leave-active\r\n      transition all 0.4s\r\n      .top, .bottom\r\n        transition all 0.4s cubic-bezier(0.86, 0.18, 0.82, 1.32)\r\n    &.normal-enter, &.normal-leave-to\r\n      opacity 0\r\n      .top\r\n        transform translate3d(0, -100px, 0)\r\n      .bottom\r\n        transform translate3d(0, 100px, 0)\r\n  .mini-player\r\n    display flex\r\n    align-items center\r\n    position fixed\r\n    left 0\r\n    bottom 0\r\n    z-index 180\r\n    width 100%\r\n    height 60px\r\n    background $color-highlight-background\r\n    &.mini-enter-active, &.mini-leave-active\r\n      transition all 0.4s\r\n    &.mini-enter, &.mini-leave-to\r\n      opacity 0\r\n    .icon\r\n      flex 0 0 40px\r\n      width 40px\r\n      padding 0 10px 0 20px\r\n      img\r\n        border-radius 50%\r\n        &.play\r\n          animation rotate 10s linear infinite\r\n        &.pause\r\n          animation-play-state paused\r\n    .text\r\n      display flex\r\n      flex-direction column\r\n      justify-content center\r\n      flex 1\r\n      line-height 20px\r\n      overflow hidden\r\n      .name\r\n        margin-bottom 2px\r\n        no-wrap()\r\n        font-size $font-size-medium\r\n        color $color-text\r\n      .desc\r\n        no-wrap()\r\n        font-size $font-size-small\r\n        color $color-text-d\r\n    .control\r\n      flex 0 0 30px\r\n      width 30px\r\n      padding 0 10px\r\n      .icon-play-mini, .icon-pause-mini, .icon-playlist\r\n        font-size 30px\r\n        color $color-theme-d\r\n      .icon-mini\r\n        font-size 32px\r\n        position absolute\r\n        left 0\r\n        top 0\r\n@keyframes rotate\r\n  0%\r\n    transform rotate(0)\r\n  100%\r\n    transform rotate(360deg)\r\n</style>"]}]}